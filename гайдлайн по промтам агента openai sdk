Этот промт находится по пути /home/semen/Desktop/промты для ИИ/гайдлайн по промтам агента openai sdk

• Гайдлайн для Codex (Prompt Design под OpenAI Agents SDK)

  - Роли и инструкции
      - System = instructions агента; developer-роль отсутствует. Держи в instructions только жёсткое ядро (Must/Should/May).
      - Пользовательский ввод приходит отдельно при запуске; instructions всегда приоритетнее.
      - Для динамики можешь передавать функцию, формирующую instructions перед запуском.
  - Формат и структура
      - Жёстко режь текст: 150–300 слов в ядре. Проговори Must/Should/May.
      - Не дублируй агентный цикл (SDK сам управляет вызовами тулов). Если нужен кастомный план — описывай как чеклист, совместимый со встроенным циклом.
      - Добавь output_type/Structured Outputs: схема (Pydantic/Zod/JSON Schema), валидация и ретраи по умолчанию.
  - Контекст и экономия
      - Помни: каждый токен = деньги и задержка. Ставь prompt caching на статичные блоки.
      - Состояние диалога веди через previous_response_id, а не перешивай историю.
      - Few-shot: максимум один эталон и один анти-пример. Если не критично — убери и опиши формат словами.
  - Инструменты
      - Описывай тул кратко: что делает, когда вызывать, ключевые аргументы. Детали и политики пусть возвращает сам тул.
      - Вынос справок/регламентов — в Function/MCP/RAG. Инструкции «может понадобиться» доставай лениво.
      - Ограничивай инструменты через allowed_tools или tool_choice, если точно знаешь, что нужно; остальные не подсовывай.
  - Безопасность
      - Никаких секретов/вебхуков в промте. Храни в конфиге тулов/секрет-менеджере.
      - Настрой guardrails: фильтры ввода/вывода, таймауты, лимиты, обработку 401/403/429/5xx, идемпотентность.
      - Разделяй доверенные/недоверенные источники, проверяй входные данные, не цитируй приватные URL.
  - Метрики и эксплуатация
      - Мониторь: следование must, полноту/точность, корректность формата, инструментальный precision/recall, p95 latency, стоимость, долю ретраев.
      - Гони ablation эксперименты: версии промта S/M/L, график «качество vs токены», ищи «локоть» и фиксируй.
      - Веди changelog и тесты на golden-наборах; автоматический линт на дубли/противоречия.
  - Чеклисты перед продом
      1. instructions компактны, нет дублей, Must/Should/May на месте.
      2. Структурированный вывод подключён, ретраи есть.
      3. Список тулов сужен, описания краткие, секреты вне промта.
      4. Guardrails и таймауты активны, previous_response_id используется.
      5. Есть мониторинг метрик, regression/golden-сценарии.
  - Шаблон system (пример)

    Must:
      - Соблюдай цикл [если нужен].
      - Используй тулы только из списка …
      - Возвращай JSON по схеме …
    Should:
      - Профессиональный тон, минимум уточнений.
    May:
      - Дополнительные шаги, если …
  - Шаблон тул-описания

    tool: find_contact
    when: нужно найти контакт по email/телефону
    params: { email?: str, phone?: str }
    returns: { id: int, name: str } | null
    policy: если нет данных → не вызывай
  - Цитирование
      - Всегда указывай источник фактов: ID, сущность, endpoint.
      - При ошибке Bitrix возвращай error/error_description как есть + следующий шаг.
  - Типичные ошибки и запреты
      - Не добавляй «ReAct» поверх встроенного цикла.
      - Не уноси секреты в промт.
      - Не держи длинные регламенты внутри instructions.
      - Не полагайся на «не знаю» без проверки кода/файлов.
  - Процедуры обновления
      - Все новые правила сначала оформляй как тул/ресурс, потом при необходимости поджимай instructions.
      - Каждое изменение сопровождай метриками и регресс-тестами.
      - Документируй решения (ADR: что изменили, зачем, метрики, как откатить).
