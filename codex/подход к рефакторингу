• Подход к рефакторингу дублирующейся логики (справка):

  - Сначала строим полную карту повторяющихся участков и зависимостей между
    ними, чтобы видеть целевую архитектуру.
  - Планируем всю последовательность изменений целиком: определяем слои/
    утилиты, которые появятся после рефакторинга, и порядок их внедрения.
  - Выполняем работу итеративно, по одному дублированию за раз, но каждый шаг
    соотносится с общей картиной (чтобы новый код сразу вписывался в целевой
    дизайн и не мешал следующим шагам).
  - На каждом шаге рефакторинг минимален и локален, без функциональных
    изменений; после шага сверяемся с планом и корректируем его, если
    возникли новые зависимости.
  - В конце убеждаемся, что все части плана реализованы и новая архитектура
    покрывает все ранее найденные дубли.